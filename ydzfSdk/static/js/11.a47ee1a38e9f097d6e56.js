webpackJsonp([11],{DOk4:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("mvHQ"),o=t.n(n),a=(t("oFuF"),{data:function(){return{signInfo:{},user:this.util.getUser(),signCode:""}},methods:{openProtocol:function(){this.$router.push("/codeProtocol")},getSignCode:function(){var e=this,s={channelNo:sessionStorage.getItem("channelNo")||"",signNo:sessionStorage.getItem("signNo")||"",aab301:this.user.aab301,aac002:this.user.idNo,aac003:this.user.idName,busiSeq:"",aac067:this.user.aae005,returnUrl:""};this.$http.post("/msc/csb/sign",s).then(function(s){s.success?(e.signCode=s.body,e.openAgree()):e.$toast(s.message)})},openAgree:function(){var e=this,s={sign:this.signCode||""};dsBridge.call("validatePwd",s,function(s){(s=JSON.parse(s)).success?(e.signInfo.aac002=e.user.idNo,e.signInfo.channelNo=sessionStorage.getItem("channelNo"),e.signInfo.signNo=sessionStorage.getItem("signNo"),e.signInfo.busiSeq=s.body.busiSeq,e.saveToken(e.signInfo)):e.$messagebox.alert(s.message)})},saveToken:function(e){var s=this;this.$http.post("/msc/csb/savetoken",e).then(function(t){if(t.success){var n={type:"1",signNo:e.signNo,busiSeq:e.busiSeq,payModel:"1"};s.$http.post("/msc/app/microPayments",n).then(function(e){if(e.success){var t=s.util.getUser();t.bae027="1",s.util.setUser(t),s.$router.push("/openSuccess")}else s.$messagebox.alert(e.message).then(function(e){s.$router.push("/")})}).catch(function(e){s.$messagebox.alert(e)})}else s.$messagebox.alert("密码验证失败："+t.message).then(function(){sessionStorage.getItem("medicalIndex")||""?s.$router.push("/"):!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.webkit.messageHandlers.close.postMessage("yes"):dsBridge.call("close","")})}).catch(function(e){var t=o()(e),n=JSON.parse(t);s.$messagebox.alert("密码验证失败："+n.response.data.message).then(function(){sessionStorage.getItem("medicalIndex")||""?s.$router.push("/"):!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.webkit.messageHandlers.close.postMessage("yes"):dsBridge.call("close","")})})}}}),i={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"agree-open"},[t("div",{staticClass:"see-protocol"},[e._v("\n        查看"),t("span",{on:{click:function(s){e.openProtocol()}}},[e._v("《医保移动支付免密支付协议》")])]),e._v(" "),t("div",{staticClass:"btn-box"},[t("div",{staticClass:"agree-btn",on:{click:function(s){e.getSignCode()}}},[e._v("同意协议并开通免密支付")])])])},staticRenderFns:[]};var c=t("VU/8")(a,i,!1,function(e){t("c7iw")},"data-v-19c2f19c",null);s.default=c.exports},c7iw:function(e,s){}});